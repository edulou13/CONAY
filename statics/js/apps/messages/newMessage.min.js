/*!
* auhtor: Luis Eduardo Miranda Barja
* (C) 2015 - mbarjaedu13@gmail.com
*/
$(function(){var a=$("#breadcrumbs").data("key");$("#breadcrumbs").removeAttr("data-key"),$(".message-menu, .sms-catalog").addClass("active"),$("#back, .back").on({click:function(a){a.preventDefault(),location.href="/mensajes/gestion"}});var e=$("input[name=nro_control]"),s=e.closest(".form-group"),o=$(s).find(".form-control-feedback");e.attr({readonly:!0}),$("#tipo").on({change:function(a){var t=+$(this).val();e.val(""),s.removeClass("has-success has-error"),o.removeClass("fa-check fa-times"),-1!=t&&($.post("/mensajes/before_save",data={_xsrf:getCookie("_xsrf"),tipo:t},function(a){-1!=a&&e.val(a)}),e.attr("name","nro_control").removeClass("only_g_names").addClass("only_msg_number").prev().text("Nro. de Control:").end())}}),$(".fileinput").fileinput();var t=$("input[name=audio]");$("form").on({submit:function(e){e.preventDefault(),e.stopPropagation();var n=$(this),r=new FormData,i=$("button[type=submit]");i.disable().hide(),t.val().length?$.post("/mensajes/adicionar_msj",data=n.form2Dict(),function(e){1==e.status?(r.append("tipo",data.tipo),r.append("nro",data.nro_control),r.append("audio",t[0].files[0]),r.append("audioname",e.audio),$.ajax({url:"http://{0}:{1}/getaudiofile".format(a.host,a.port),type:"POST",data:r,mimeType:"multipart/form-data",contentType:!1,cache:!1,processData:!1,success:function(a){a?location.href="/mensajes/gestion":(s.removeClass("has-success").addClass("has-error"),o.removeClass("fa-check").addClass("fa-times"),i.enable().show())}})):(s.removeClass("has-success").addClass("has-error"),o.removeClass("fa-check").addClass("fa-times"),i.enable().show())}):i.enable().show()}})});