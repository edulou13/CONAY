/*!
* auhtor: Luis Eduardo Miranda Barja
* (C) 2015 - mbarjaedu13@gmail.com
*/
$(function(){$(".pregnant-menu").addClass("active"),$("#back, .back").on({click:function(e){e.preventDefault(),location.href="/embarazos/gestion?id_per="+$("input[name=id_per]").val()}}),$("input[name=f_nac]").on({"click focusin":function(e){$(this).datetimepicker({locale:"es",format:"DD/MM/YYYY"})}}).inputmask({mask:"99/99/9999"});var e=$("form").data("key"),t=function(t){for(var a=[$('<option value="-1">-- Elija Una --</option>')],n=0;n<t.length;n++){var o=t[n],i=$("<option/>",{value:o.id_etn,text:o.nombre});o.id_etn==e.id_etn&&i.attr("selected",!0),a.push(i)}return a},a=function(t){for(var a=[$('<option value="-1">-- Elija Una --</option>')],n=0;n<t.length;n++){var o=t[n],i=$("<option/>",{value:o.id_red,text:o.nombre}).data("municipios",o.municipios);e.id_red==o.id_red&&i.attr("selected",!0),a.push(i)}return a},n=function(t){for(var a=[$('<option value="-1">-- Elija Uno --</option>')],n=0;n<t.length;n++){var o=t[n],i=$("<option/>",{value:o.id_mup,text:o.nombre}).data("comunidades",o.comunidades);e.id_mup==o.id_mup&&i.attr("selected",!0),a.push(i)}return a},o=function(t){for(var a=[$('<option value="-1">-- Elija Uno --</option>')],n=0;n<t.length;n++){var o=t[n],i=$("<option/>",{value:o.id_com,text:o.nombre}).data("centros",o.centros_salud);e.id_com==o.id_com&&i.attr("selected",!0),a.push(i)}return a},i=function(t){for(var a=[$("<option/>",{value:-1,text:"-- Elija Uno --"})],n=0;n<t.length;n++){var o=t[n],i=$("<option/>",{value:o.id_cen,text:o.nombre});e.centro_salud==o.id_cen&&i.attr("selected",!0),a.push(i)}return a};e.is_pregnant?($.post("/etnias/disponibles",data={_xsrf:getCookie("_xsrf")},function(e){$("#etnia").html(t(e))}),$.post("/redes_salud/geografia",data={_xsrf:$("input[name=_xsrf]").val()},function(e){$("#red").html(a(e)).on({change:function(){var e=+$(this).val(),t=$(this).find('option[value="'+e+'"]').data("municipios");e>0?$("#municipio").html(n(t)).on({change:function(){var e=+$(this).val();e>0?(comunidades=$(this).find('option[value="'+e+'"]').data("comunidades"),$("#comunidad").html(o(comunidades)).on({change:function(){var e=+$(this).val();e>0?(centros=$(this).find('option[value="'+e+'"]').data("centros"),$("#centro").html(i(centros))):$("centro").html('<option value="-1">-- Elija Una --</option>')}}).change()):($("#comunidad").html('<option value="-1">-- Elija Una --</option>'),$("#centro").html('<option value="-1">-- Elija Una --</option>'))}}).change():($("#municipio").html('<option value="-1">-- Elija Uno --</option>'),$("#comunidad").html('<option value="-1">-- Elija Una --</option>'),$("#centro").html('<option value="-1">-- Elija Una --</option>'))}}).change()})):$(".locations").disable().hide();var s=+$("input[name=telf]").val(),r=$("input[name=c_telf]").val(),l=$("input[name=ci]").val(),c=$("input[name=c_id_per]").val(),d=$("input[name=c_nombres]").val(),u=$("input[name=c_apellidos]").val(),p=$("select[name=c_sexo]").val();$("input[name=telf]").on({blur:function(e){var t=$(this),a=$(this).val();s!=+a&&8==a.length&&a.match(t.data("pattern"))&&(a!=r?$.post("/personas/v_telf",data={_xsrf:$("input[name=_xsrf]").val(),telf:a},function(e){e&&(t.val(s).focus().closest(".form-group").removeClass("has-success has-error"),swal({title:"Error!",text:"El nro. "+a+", está registrado!.\nPor favor use otro.",type:"error",confirmButtonText:"Continuar"}))}):t.val(s).focus().closest(".form-group").removeClass("has-success has-error"))}}),$("input[name=c_telf]").on({keyup:function(e){var t=$(this),a=t.val();$("input[name=c_id_per]").enable().val(c),8==a.length&&a!=r&&a.match(t.data("pattern"))?a!=s?($("form").find(".optional").enable().show(),swal({title:"Advertencia!",text:"Desea cambiar de contacto?",type:"warning",showCancelButton:!0,cancelButtonText:"Cancelar",confirmButtonText:"Cambiar",closeOnConfirm:!0},function(){$("form").find(".optional").show().end().find(".contact-name").text("Contacto"),$.post("/personas/v_telf",data={_xsrf:$("input[name=_xsrf]").val(),telf:a},function(e){e?$.post("/personas/getbycellphone",data={_xsrf:getCookie("_xsrf"),telf:a},function(e){c=e.id_per,d=e.nombres,u=e.apellidos,$("input[name=c_nombres]").val(e.nombres),$("input[name=c_apellidos]").val(e.apellidos),$("input[name=c_id_per]").enable().val(e.id_per),$("form").find(".optional").disable().hide().end().find(".contact-name").text(e.persona),$("select[name=c_sexo]").find("option:selected").removeAttr("selected").end().find('option[value="'+e.sexo+'"]').attr("selected",!0).select()}):($("input[name=c_id_per]").disable(),$("form").find(".optional").enable().show(),$("input[name=c_nombres], input[name=c_apellidos]").val(""),$("select[name=c_sexo]").find("option:selected").removeAttr("selected").end().find('option[value="-1"]').attr("selected",!0).select())})})):($("form").find(".optional").enable().show().end().find(".contact-name").text("Contacto"),t.val(r).focus().closest(".form-group").removeClass("has-success has-error").find("span").removeClass("fa-check fa-times"),swal({title:"Error!",text:"El nro. de contacto, no puede ser igual al de la embarazada!.\nPor favor elija otro.",type:"error",confirmButtonText:"Continuar"})):8==a.length?(t.val(r).closest(".form-group").removeClass("has-success has-error").find("span").removeClass("fa-check fa-times"),$("input[name=c_id_per]").enable(),$("form").find(".optional").enable().show().end().find(".contact-name").text("Contacto"),$("input[name=c_nombres]").val(d),$("input[name=c_apellidos]").val(u),$("select[name=c_sexo]").find("option:selected").removeAttr("selected").end().find('option[value="'+p+'"]').attr("selected",!0).select()):t.closest(".form-group").removeClass("has-success").addClass("has-error").find("span").removeClass("fa-check").addClass("fa-times")}}),l=8==l.length?l:"",$("input[name=ci]").on({blur:function(e){var t=$(this),a=$(this).val();a.length>=7&&a.length<=8&&a!=l&&$.post("/personas/v_ci",data={_xsrf:getCookie("_xsrf"),ci:t.val()},function(e){e?(t.val(l).focus().closest(".form-group").removeClass("has-success has-error"),swal({title:"Error!",text:"El CI: "+a+", está registrado!.\nPor favor use otro.",type:"error",confirmButtonText:"Continuar"})):t.closest(".form-group").removeClass("has-error").addClass("has-success").find("span").removeClass("fa-times").addClass("fa fa-check")})}}),$("form").on({submit:function(e){e.preventDefault(),e.stopPropagation();var t=$(this),a=$(this).find("button[type=submit]");a.disable().hide(),$.post("/embarazadas/modificar_embarazada",data=t.form2Dict(),function(e){if(e)location.href="/embarazos/gestion?id_per="+$("input[name=id_per]").val();else{a.enable().show();var t=$("input[name=c_telf]");$.post("/personas/v_telf",data={_xsrf:$("input[name=_xsrf]").val(),telf:t.val()},function(e){e&&(swal({title:"Error!",text:"El nro. "+t.val()+", está registrado!.\nPor favor elija otro.",type:"error",confirmButtonText:"Continuar",closeOnConfirm:!0}),t.val(r))})}})}})});