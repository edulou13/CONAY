/*!
* auhtor: Luis Eduardo Miranda Barja
* (C) 2015 - mbarjaedu13@gmail.com
*/
$(function(){$(".pregnant-menu").addClass("active"),$("#cancel, .back").on({click:function(t){t.preventDefault(),location.href="/embarazadas/gestion"}}),$("input[name=f_nac], #inputParto_prob").on({"click focusin":function(t){$(this).datetimepicker({locale:"es",format:"DD/MM/YYYY"})}}).inputmask({mask:"99/99/9999"}),$.post("/etnias/disponibles",data={_xsrf:getCookie("_xsrf")},function(e){$("#inputId_etn").html(t(e)),$("#inputId_etnc").html($("#inputId_etn").html())}),$.post("/redes_salud/geografia",data={_xsrf:getCookie("_xsrf")},function(t){for(var e=[$('<option value="-1">-- Elija Una --</option>')],a=0;a<t.length;a++){var n=t[a],o=$("<option/>",{value:n.id_red,text:n.nombre}).data("municipios",n.municipios);e.push(o)}$("#inputRedes").html(e)}),$("#inputRedes").on({change:function(t){var e=$(this),a=+$(this).val();if($("#inputMunicipio").html('<option value="-1">-- Elija Uno --</option>').trigger("change"),$("#inputId_com").html('<option value="-1">-- Elija Una --</option>').trigger("change"),-1!=a){for(var n=e.find('option[value="'+a+'"]').data("municipios"),o=[$('<option value="-1">-- Elija Uno --</option>')],s=0;s<n.length;s++){var r=n[s],i=$("<option/>",{value:r.id_mup,text:r.nombre}).data("comunidades",r.comunidades);o.push(i)}$("#inputMunicipio").html(o)}}}),$("#inputMunicipio").on({change:function(t){var e=$(this),a=+$(this).val();if($("#inputId_com").html('<option value="-1">-- Elija Una --</option>').trigger("change"),-1!=a){for(var n=e.find('option[value="'+a+'"]').data("comunidades"),o=[$('<option value="-1">-- Elija Una --</option>')],s=0;s<n.length;s++){var r=n[s],i=$("<option/>",{value:r.id_com,text:r.nombre}).data("centros",r.centros_salud);o.push(i)}$("#inputId_com").html(o)}}}),$("#inputId_com").on({change:function(t){var e=$(this),a=+$(this).val();if($("#inputCentros").html('<option value="-1">-- Elija Uno --</option>').trigger("change"),-1!=a){for(var n=e.find('option[value="'+a+'"]').data("centros"),o=[$('<option value="-1">-- Elija Uno --</option>')],s=0;s<n.length;s++){var r=n[s],i=$("<option/>",{value:r.id_cen,text:r.nombre});o.push(i)}$("#inputCentros").html(o)}}});var t=function(t){for(var e=['<option value="-1">-- Elija Una --</option>'],a=0;a<t.length;a++){var n=t[a];e.push('<option value="'+n.id_etn+'">'+n.nombre+"</option>")}return e.join("")},e=function(t){var e=null;return $.ajaxSetup({async:!1}),$.post("/personas/v_pregnantstelf",data={_xsrf:getCookie("_xsrf"),telf:t},function(t){e=t}),$.ajaxSetup({async:!0}),e},a=function(t){var e=null;return $.ajaxSetup({async:!1}),$.post("/personas/v_telf",data={_xsrf:getCookie("_xsrf"),telf:t},function(t){e=t}),$.ajaxSetup({async:!0}),e},n=$(".contact-form").clone();$("#inputTelf").on({keyup:function(t){var a=$(this),o=$(this).val(),s=$(this).data("pattern");if($("form").find(".prg-name").text("Nueva Embarazada").end().find(".contact-name").text("Contacto"),$(".contact-form").html("").html(n.html()).find("#inputId_etnc").html($("#inputId_etn").html()),null==o.match(s)&&0==o.length)$(".prg_signal").find("select").find('option[value="1"]').disable().end().find('option[value="0"]').attr("selected",!0).end().trigger("change"),$(".contact-form").html("").html(n.html()).find("#inputId_etnc").html($("#inputId_etn").html());else if(8==o.length&&"number"==$.type(+o)){var r=e(o);0==r.status?($(".prg_signal").find("select").find('option[value="1"]').attr("selected",!0).enable().end().trigger("change"),a.closest(".form-group").removeClass("has-error").addClass("has-success")):1==r.status?(a.closest(".form-group").removeClass("has-error").addClass("has-success"),$("form").find(".prg-name").text(r.p_data).end().find(".prg_optional").disable().find(":input").disable().end().hide().end()):($(".prg_signal").find("select").find('option[value="1"]').removeAttr("selected").disable().end().trigger("change"),a.val("").focus(),swal({title:"Error!",text:null!=r.p_data?r.p_data+".\nEstÃ¡ registrado con el nro. "+o:"",type:"error",confirmButtonText:"Continuar"}))}else a.closest(".form-group").removeClass("has-success").addClass("has-error")}}),$("input[name=ci]").on({blur:function(t){var e=$(this),a=e.val();a.length>6&&a.length<9&&a.match(e.data("pattern"))?$.post("/personas/v_ci",data={_xsrf:getCookie("_xsrf"),ci:a},function(t){t?(e.val("").focus().closest(".form-group").removeClass("has-success").addClass("has-error"),swal({title:"Error!",text:'"'+a+'", se encuentra registrado!.\nPor favor elija otro.',type:"error",confirmButtonText:"Continuar"})):e.closest(".form-group").removeClass("has-error").addClass("has-success")}):a.length?e.closest(".form-group").removeClass("has-success").addClass("has-error"):e.closest(".form-group").removeClass("has-success has-error")}}),$("form").on("keyup","#inputTelfc",function(t){var e=$(this).val(),n=$(this).data("pattern"),o=$(this),s=$("#inputTelf").val();null!=e.match(n)&&e!=s?0==a(e)?($("form").find(".contact-name").text("Contacto").end().find(".optional").enable().show(),o.closest(".form-group").removeClass("has-error").addClass("has-success"),$("#inputCoberturac").find('option[value="1"]').attr("selected",!0).end().trigger("change")):$.post("/personas/getbycellphone",data={_xsrf:getCookie("_xsrf"),telf:e},function(t){$("form").find(".optional").disable().find(":input").disable().end().hide().end().find(".contact-name").text(t.persona)}):8==e.length&&e==s?(o.val("").closest(".form-group").removeClass("has-success").addClass("has-error").find("span").removeClass("fa-check").addClass("fa-times"),$("form").find(".optional").enable().find(":input").enable().end().show().end().find(".contact-name").text("Contacto"),swal({title:"Error!",text:"El nro. de contacto, no debe ser igual al de la embaraza!.\nPor favor elija otro.",type:"error",confirmButtonText:"Continuar"})):o.closest(".form-group").removeClass("has-success").addClass("has-error").find("span").removeClass("fa-check").addClass("fa-times")}),$("form").on("change","select",function(t){var e=$(this);"-1"!=e.val()?e.closest(".form-group").removeClass("has-error").addClass("has-success"):e.closest(".form-group").removeClass("has-success").addClass("has-error")}),$("form").on({submit:function(t){t.preventDefault(),t.stopPropagation();var e=$(this),a=e.find("button[type=submit]");a.disable().hide(),$.post("/embarazadas/nueva_embarazada",data=e.form2Dict(),function(t){t?location.href="/embarazadas/gestion":(a.enable().show(),$("#inputParto_prob").val("").focus().closest(".form-group").removeClass("has-success").addClass("has-error").find("span").removeClass("fa-check").addClass("fa-times"))})}})});